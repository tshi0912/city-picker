"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){"function"==typeof define&&define.amd?define(["jquery","ChineseDistricts"],t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?t(require("jquery"),require("ChineseDistricts")):t(jQuery,ChineseDistricts)}(function(d,r){if(void 0===r)throw new Error('The file "city-picker.data.js" must be included first!');var a="citypicker",s="change."+a,l="province",u="city",p="district",f="town",m="village",v="committee";function h(t,i){this.$element=d(t),this.$dropdown=null,this.options=d.extend({},h.DEFAULTS,d.isPlainObject(i)&&i),this.active=!1,this.dems=[],this.needBlur=!1,this.init()}h.prototype={constructor:h,init:function(){this.defineDems(),this.render(),this.bind(),this.active=!0,this.close(!0)},render:function(){var t=this.getPosition(),i=this.$element.attr("placeholder")||this.options.placeholder,e='<span class="city-picker-span" style=" '.concat(this.getWidthStyle(t.width)," height:").concat(t.height+6,"px;line-height:").concat(t.height+5,'px;"> ').concat(i?'<span class="placeholder"> ${placeholder} </span>':"",'  <span class="title"></span><div class="arrow"></div></span>'),s='<div class="city-picker-dropdown" style="left:0;top:100%; '.concat(this.getWidthStyle(t.width,!0),'">\n                                <div class="city-select-wrap">\n                                    <div class="city-select-tab">\n                                        <a class="active" data-count="province">省份</a> \n                                        ').concat(this.includeDem("city")?'<a data-count="city">城市</a>':"","  \n                                        ").concat(this.includeDem("district")?'<a data-count="district">区县</a>':""," \n                                        ").concat(this.includeDem("town")?'<a data-count="town">街道</a>':""," \n                                        ").concat(this.includeDem("village")?'<a data-count="village">居委</a>':""," \n                                        ").concat(this.includeDem("committee")?'<a data-count="committee">路</a>':"",' \n                                    </div>\n                                <div class="city-select-content">\n                                    <div class="city-select province" data-count="province"></div>\n                                    ').concat(this.includeDem("city")?'<div class="city-select city" data-count="city"></div>':""," \n                                    ").concat(this.includeDem("district")?'<div class="city-select district" data-count="district"></div>':""," \n                                    ").concat(this.includeDem("town")?'<div class="city-select town" data-count="town"></div>':""," \n                                    ").concat(this.includeDem("village")?'<div class="city-select village" data-count="village"></div>':""," \n                                    ").concat(this.includeDem("committee")?'<div class="city-select committee" data-count="committee"></div>':""," \n                                </div>\n                             </div>");this.$element.addClass("city-picker-input"),this.$textspan=d(e).insertAfter(this.$element),this.$dropdown=d(s).insertAfter(this.$textspan);var n=this.$dropdown.find(".city-select");d.each(this.dems,d.proxy(function(t,i){this["$"+i]=n.filter("."+i)},this)),this.refresh()},refresh:function(e){this.$dropdown.find(".city-select").data("item",null);var s=(s=this.$element.val()||"").split("/");d.each(this.dems,d.proxy(function(t,i){s[t]&&t<s.length?this.options[i]=s[t]:e&&(this.options[i]=""),this.output(i)},this)),this.tab(l),this.feedText(),this.feedVal()},defineDems:function(){var e=!1;d.each([l,u,p,f,m,v],d.proxy(function(t,i){e||this.dems.push(i),i===this.options.level&&(e=!0)},this))},includeDem:function(t){return-1!==d.inArray(t,this.dems)},getPosition:function(){var t,i=this.$element.position(),e=this.getSize(this.$element),s=e.height,n=e.width;return this.options.responsive&&(t=this.$element.offsetParent().width())&&(.99<(n/=t)&&(n=1),n=100*n+"%"),{top:i.top||0,left:i.left||0,height:s,width:n}},getSize:function(t){var i,e,s;return t.is(":visible")?s={width:t.outerWidth(),height:t.outerHeight()}:((i=d("<div />").appendTo(d("body"))).css({position:"absolute !important",visibility:"hidden !important",display:"block !important"}),s={width:(e=t.clone().appendTo(i)).outerWidth(),height:e.outerHeight()},i.remove()),s},getWidthStyle:function(t,i){return this.options.responsive&&!d.isNumeric(t)?"width:"+t+";":"width:"+(i?Math.max(320,t):t)+"px;"},bind:function(){var c=this;d(document).on("click",this._mouteclick=function(t){var i,e,s,n=d(t.target);n.is(".city-picker-span")?e=n:n.is(".city-picker-span *")&&(e=n.parents(".city-picker-span")),n.is(".city-picker-input")&&(s=n),n.is(".city-picker-dropdown")?i=n:n.is(".city-picker-dropdown *")&&(i=n.parents(".city-picker-dropdown")),(!s&&!e&&!i||e&&e.get(0)!==c.$textspan.get(0)||s&&s.get(0)!==c.$element.get(0)||i&&i.get(0)!==c.$dropdown.get(0))&&c.close(!0)}),this.$element.on("change",this._changeElement=d.proxy(function(){this.close(!0),this.refresh(!0)},this)).on("focus",this._focusElement=d.proxy(function(){this.needBlur=!0,this.open()},this)).on("blur",this._blurElement=d.proxy(function(){this.needBlur&&(this.needBlur=!1,this.close(!0))},this)),this.$textspan.on("click",function(t){var i,e=d(t.target);c.needBlur=!1,e.is(".select-item")?(i=e.data("count"),c.open(i)):c.$dropdown.is(":visible")?c.close():c.open()}).on("mousedown",function(){c.needBlur=!1}),this.$dropdown.on("click",".city-select a",function(){var t=d(this).parents(".city-select"),i=t.find("a.active"),e=0===t.next().length;i.removeClass("active"),d(this).addClass("active"),i.data("code")!==d(this).data("code")&&(t.data("item",{address:d(this).attr("title"),code:d(this).data("code")}),d(this).trigger(s),c.feedText(),c.feedVal(!0),e&&c.close())}).on("click",".city-select-tab a",function(){var t;d(this).hasClass("active")||(t=d(this).data("count"),c.tab(t))}).on("mousedown",function(){c.needBlur=!1}),this.$province&&this.$province.on(s,this._changeProvince=d.proxy(function(){this.output(u),this.output(p),this.output(f),this.output(m),this.output(v),this.tab(u)},this)),this.$city&&this.$city.on(s,this._changeCity=d.proxy(function(){this.output(p),this.output(f),this.output(m),this.output(v),this.tab(p)},this)),this.$district&&this.$district.on(s,this._changeDistrict=d.proxy(function(){this.output(f),this.output(m),this.output(v),this.tab(f)},this)),this.$town&&this.$town.on(s,this._changeTown=d.proxy(function(){this.output(m),this.output(v),this.tab(m)},this)),this.$village&&this.$village.on(s,this._changeVillage=d.proxy(function(){this.output(v),this.tab(v)},this)),this.$committee&&this.$committee.on(s,this._changeCommittee=d.proxy(function(){},this))},open:function(t){t=t||l,this.$dropdown.show(),this.$textspan.addClass("open").addClass("focus"),this.tab(t)},close:function(t){this.$dropdown.hide(),this.$textspan.removeClass("open"),t&&this.$textspan.removeClass("focus")},unbind:function(){d(document).off("click",this._mouteclick),this.$element.off("change",this._changeElement),this.$element.off("focus",this._focusElement),this.$element.off("blur",this._blurElement),this.$textspan.off("click"),this.$textspan.off("mousedown"),this.$dropdown.off("click"),this.$dropdown.off("mousedown"),this.$province&&this.$province.off(s,this._changeProvince),this.$city&&this.$city.off(s,this._changeCity),this.$district&&this.$district.off(s,this._changeDistrict),this.$town&&this.$town.off(s,this._changeTown),this.$village&&this.$village.off(s,this._changeVillage),this.$committee&&this.$committee.off(s,this._changeCommittee)},getText:function(){var e="";return this.$dropdown.find(".city-select").each(function(){var t=d(this).data("item"),i=d(this).data("count");t&&(e+=(d(this).hasClass("province")?"":"/")+'<span class="select-item" data-count="'+i+'" data-code="'+t.code+'">'+t.address+"</span>")}),e},getPlaceHolder:function(){return this.$element.attr("placeholder")||this.options.placeholder},feedText:function(){this.getText()?(this.$textspan.find(">.placeholder").hide(),this.$textspan.find(">.title").html(this.getText()).show()):(this.$textspan.find(">.placeholder").text(this.getPlaceHolder()).show(),this.$textspan.find(">.title").html("").hide())},getVal:function(){var i="";return this.$dropdown.find(".city-select").each(function(){var t=d(this).data("item");t&&(i+=(d(this).hasClass("province")?"":"/")+t.address)}),i},getCode:function(t){var e={},s=[];return this.$textspan.find(".select-item").each(function(){var t=d(this).data("code"),i=d(this).data("count");e[i]=t,s.push(t)}),t?e[t]:s.join("/")},feedVal:function(t){this.$element.val(this.getVal()),t&&this.$element.trigger("cp:updated")},output:function(n){var t,i,e,c,s=this.options,o=this["$"+n],a=n===l?{}:[],h=null;o&&o.length&&(t=o.data("item"),c=(t?t.address:null)||s[n],e=n===l?86:n===u?this.$province&&this.$province.find(".active").data("code"):n===p?this.$city&&this.$city.find(".active").data("code"):n===f?this.$district&&this.$district.find(".active").data("code"):n===m?this.$town&&this.$town.find(".active").data("code"):n===v?this.$village&&this.$village.find(".active").data("code"):e,i=d.isNumeric(e)?r[e]:null,d.isPlainObject(i)&&d.each(i,function(t,i){var e;if(n===l){e=[];for(var s=0;s<i.length;s++)i[s].address===c&&(h={code:i[s].code,address:i[s].address}),e.push({code:i[s].code,address:i[s].address,selected:i[s].address===c});a[t]=e}else i===c&&(h={code:t,address:i}),a.push({code:t,address:i,selected:i===c})}),o.html(n===l?this.getProvinceList(a):this.getList(a,n)),o.data("item",h))},getProvinceList:function(t){var e=[],s=this,n=this.options.simple;return d.each(t,function(t,i){e.push('<dl class="clearfix">'),e.push("<dt>"+t+"</dt><dd>"),d.each(i,function(t,i){e.push('<a title="'+(i.address||"")+'" data-code="'+(i.code||"")+'" class="'+(i.selected?" active":"")+'">'+(n?s.simplize(i.address,l):i.address)+"</a>")}),e.push("</dd></dl>")}),e.join("")},getList:function(t,e){var s=[],n=this,c=this.options.simple;return s.push('<dl class="clearfix"><dd>'),d.each(t,function(t,i){s.push('<a title="'+(i.address||"")+'" data-code="'+(i.code||"")+'" class="'+(i.selected?" active":"")+'">'+(c?n.simplize(i.address,e):i.address)+"</a>")}),s.push("</dd></dl>"),s.join("")},simplize:function(t,i){return t=t||"",i===l?t.replace(/[省,市,自治区,壮族,回族,维吾尔]/g,""):i===u?t.replace(/[市,地区,回族,蒙古,苗族,白族,傣族,景颇族,藏族,彝族,壮族,傈僳族,布依族,侗族]/g,"").replace("哈萨克","").replace("自治州","").replace(/自治县/,""):i===p?2<t.length?t.replace(/[市,区,县,旗]/g,""):t:void 0},tab:function(t){var i=this.$dropdown.find(".city-select"),e=this.$dropdown.find(".city-select-tab > a"),s=this["$"+t],n=this.$dropdown.find('.city-select-tab > a[data-count="'+t+'"]');s&&(i.hide(),s.show(),e.removeClass("active"),n.addClass("active"))},reset:function(){this.$element.val(null).trigger("change")},destroy:function(){this.unbind(),this.$element.removeData(a).removeClass("city-picker-input"),this.$textspan.remove(),this.$dropdown.remove()},getAllVal:function(){function t(t,i){var e=i.$element.next().find("span[data-count="+t+"]").attr("data-code");return void 0===e?"":e}function i(t,i){var e=i.$element.next().find("span[data-count="+t+"]").html();return void 0===e?"":e}return{province:{code:t("province",this),name:i("province",this)},city:{code:t("city",this),name:i("city",this)},district:{code:t("district",this),name:i("district",this)},town:{code:t("town",this),name:i("town",this)},village:{code:t("village",this),name:i("village",this)},committee:{code:t("committee",this),name:i("committee",this)}}}},h.DEFAULTS={simple:!1,responsive:!0,placeholder:"请选择省/市/区/街道/居委",level:"village",province:"",city:"",district:"",town:"",village:"",committee:""},h.setDefaults=function(t){d.extend(h.DEFAULTS,t)},h.other=d.fn.citypicker,d.fn.citypicker=function(n){var c,o=[].slice.call(arguments,1);return this.each(function(){var t,i,e=d(this),s=e.data(a);if(!s){if(/destroy/.test(n))return;t=d.extend({},e.data(),d.isPlainObject(n)&&n),e.data(a,s=new h(this,t))}"string"==typeof n&&d.isFunction(i=s[n])&&(c=i.apply(s,o))}),void 0===c?this:c},d.fn.citypicker.Constructor=h,d.fn.citypicker.setDefaults=h.setDefaults,d.fn.citypicker.noConflict=function(){return d.fn.citypicker=h.other,this},d(function(){d('[data-toggle="city-picker"]').citypicker()})});